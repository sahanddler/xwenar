<!doctype html>
<html lang="ckb" dir="rtl">
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- FAVICON (ADD HERE) -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <title>Ø®ÙˆÛÙ†Û•Ø±</title>
  <link rel="stylesheet" href="style.css" />

    <meta name="description" content="Ú©ØªÛØ¨Ø®Ø§Ù†Û•ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§ÚµÛŒ Ú©ÙˆØ±Ø¯ÛŒ Ø¨Û† Ø®ÙˆÛÙ†Ø¯Ù† Ùˆ ÙÛØ±Ø¨ÙˆÙˆÙ†. Ù‡Û•Ø²Ø§Ø±Ø§Ù† Ú©ØªÛØ¨ Ù„Û• ÛŒÛ•Ú© Ø´ÙˆÛÙ†.">
<meta name="keywords" content="Ú©ØªÛØ¨ØŒ Ú©ÙˆØ±Ø¯ÛŒØŒ Ø®ÙˆÛÙ†Ø¯Ù†ØŒ PDFØŒ Ú©ØªØ§Ø¨ØŒ Kurdish books">
<meta name="author" content="Xwenar Library">
<meta name="robots" content="index, follow">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="topbar">
  <div class="row">
    <div class="brand" onclick="location.href='index.html'" style="cursor:pointer;">
      <div class="logo"></div>
      <span id="title">Xwenar</span>
    </div>

    <div class="actions">
      <div class="input">
        <input id="search" placeholder="Ú¯Û•Ú•Ø§Ù† Ø¨Û• Ù†Ø§ÙˆÛŒ Ù†ÙˆÙˆØ³Û•Ø± ÛŒØ§Ù† Ú©ØªÛØ¨..." style="font-family: 'rabar';" />
      </div>
      <select id="sort" class="select">
        <option value="az">Ø¦Ù€ â† Û</option>
        <option value="za">Û â† Ø¦Ù€</option>
      </select>
      <button id="reload" class="btn">Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•</button>
    </div>
  </div>
</div>

<div class="container">
  <div class="small" id="status">Ú†Ø§ÙˆÛ•Ú•ÛØ¨Û•...</div>
  <div id="grid" class="grid"></div>
  <div id="empty" class="small" style="display:none; padding:16px;">Ù‡ÛŒÚ† Ú©ØªÛØ¨ÛÙƒ Ø¨Û•Ø±Ø¯Û•Ø³Øª Ù†ÛŒÛŒÛ•.</div>
</div>

<script src="app.js"></script>
<script>
const file = qs("file");
const name = qs("name") || "Books";


  document.getElementById("reload").onclick = async ()=>{
  elStatus.textContent = "Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ•...";
  
  all = [];
  filtered = [];
  elGrid.innerHTML = "";

  // ğŸ”¥ FORCE refresh (bypass cache)
  all = await fetchBooks(file, true);

  elStatus.textContent = `${all.length} Ú©ØªÛØ¨ Ø¨Û•Ø±Ø¯Û•Ø³ØªÛ•`;
  apply();
};

const elGrid = document.getElementById("grid");
const elEmpty = document.getElementById("empty");
const elStatus = document.getElementById("status");
const elSearch = document.getElementById("search");
const elSort = document.getElementById("sort");

let all = [];
let filtered = [];
let page = 0;
const SIZE = 20;

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

function renderBatch(reset=false){
  if(reset){
    elGrid.innerHTML = "";
    page = 0;
  }

  const start = page * SIZE;
  const chunk = filtered.slice(start, start + SIZE);
  if(!chunk.length) return;

  chunk.forEach(b=>{
    const realId = all.indexOf(b);

    elGrid.insertAdjacentHTML("beforeend", `
      <div class="card">
        <div class="cover" onclick="openBook(${realId})" style="cursor:pointer">
          <img src="${b.image}"
               loading="lazy"
               decoding="async"
               width="190"
               height="220"
               alt="${escapeHtml(b.title)}">
          <div class="badge">${escapeHtml(name)}</div>
        </div>

        <div class="meta">
          <div class="title">${escapeHtml(b.title)}</div>
          <div class="author">${escapeHtml(b.author)}</div>

          <button class="btn" style="margin-top:8px;width:100%" onclick="openBook(${realId})">
            Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú©ØªÛØ¨
          </button>
        </div>
      </div>
    `);
  });

  page++;
}

function apply(){
  const q = elSearch.value.trim().toLowerCase();

  filtered = all.filter(b =>
    b.title.toLowerCase().includes(q) ||
    b.author.toLowerCase().includes(q)
  );

  filtered.sort((a,b)=>{
    const x=a.title.toLowerCase(), y=b.title.toLowerCase();
    return elSort.value==="za" ? y.localeCompare(x) : x.localeCompare(y);
  });

  elEmpty.style.display = filtered.length ? "none" : "block";
  renderBatch(true);
}

window.openBook = function(realId){
  location.href =
    `book.html?file=${encodeURIComponent(file)}&id=${realId}&name=${encodeURIComponent(name)}`;
};

window.addEventListener("scroll",()=>{
  if(window.innerHeight + window.scrollY > document.body.offsetHeight - 300){
    renderBatch();
  }
});

async function load(){
  elStatus.textContent = "Ú†Ø§ÙˆÛ•Ú•ÙˆØ§Ù†Ø¨Û•...";
  all = await fetchBooks(file);
  elStatus.textContent = `${all.length} Ú©ØªÛØ¨ Ø¨Û•Ø±Ø¯Û•Ø³ØªÛ•`;
  apply();
}

document.getElementById("reload").onclick = load;
elSearch.addEventListener("input", apply);
elSort.addEventListener("change", apply);

load();
</script>
<footer class="footer-modern">
  <div class="footer-wrap">

    <!-- Brand -->
    <div class="footer-col">
      <div class="footer-brand">
        <div class="logo"></div>
        <span>Xwenar</span>
      </div>
      <p class="footer-desc">
        Ú©ØªÛØ¨Ø®Ø§Ù†Û•ÛŒÛ•Ú©ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§ÚµÛŒ Ø¨Û† Ø®ÙˆÛÙ†Ø¯Ù†ØŒ ÙÛØ±Ø¨ÙˆÙˆÙ† Ùˆ Ú¯Û•Ø´Û•Ù¾ÛØ¯Ø§Ù†
      </p>
    </div>

    <!-- Links -->
    <div class="footer-col">
      <h4>Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ</h4>
      <a href="#">Ø¯Û•Ø±Ø¨Ø§Ø±Û•ÛŒ Ø¦ÛÙ…Û•</a>
      <a href="#">ÛŒØ§Ø±Ù…Û•ØªÛŒ</a>
      <a href="#">Ø³ÛŒØ§Ø³Û•ØªÛŒ ØªØ§ÛŒØ¨Û•ØªÛŒ</a>
      <a href="#">Ù…Û•Ø±Ø¬Û•Ú©Ø§Ù†</a>
    </div>

    <!-- Stores -->
    <div class="footer-col">
      <h4>Ø¯Ø§Ú¯Ø±ØªÙ†</h4>
      <div class="store-btns">
        <a href="#" class="store google">
          <i class="fab fa-google-play"></i>
          <span>Play Store</span>
        </a>
        <a href="#" class="store apple">
          <i class="fab fa-apple"></i>
          <span>App Store</span>
        </a>
      </div>
    </div>

    <!-- Social -->
    <div class="footer-col">
      <h4>Ø´ÙˆÛÙ†Û•Ú©Ø§Ù†Ù…Ø§Ù†</h4>
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-telegram-plane"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-x-twitter"></i></a>
      </div>
    </div>

  </div>

  <div class="footer-bottom">
    Â© 2026 Xwenar Library â€” All rights reserved
  </div>
</footer>

</body>
</html>
